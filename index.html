<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P&C Candys</title>
    <link rel="icon" href="assets/Logo_Principal.png">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background-color: #FFF8F0;
            color: #333;
            line-height: 1.6;
        }

        header {
            text-align: center;
            padding: 30px 20px;
            background: linear-gradient(135deg, #FF5733, #FF8C66);
            color: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        header img {
            max-width: 180px;
            height: auto;
            transition: transform 0.3s ease;
        }

        header img:hover {
            transform: scale(1.05);
        }

        nav {
            background-color: #FFE4C4;
            padding: 15px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        nav a {
            margin: 0 20px;
            text-decoration: none;
            color: #333;
            font-weight: 600;
            transition: color 0.3s ease;
        }

        nav a:hover {
            color: #FF5733;
        }

        section {
            padding: 60px 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        h2 {
            text-align: center;
            color: #FF5733;
            margin-bottom: 30px;
            font-weight: 700;
            font-size: 2.2em;
        }

        .quienes-somos {
            text-align: center;
            font-size: 1.2em;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.8;
        }

        .gallery {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
        }

        @media (max-width: 768px) {
            .gallery {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .gallery {
                grid-template-columns: 1fr;
            }
        }

        .gallery-item {
            background-color: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .gallery-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
        }

        .gallery-item img {
            width: 100%;
            height: 180px;
            object-fit: cover;
        }

        .products, .charolas, .extras {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        @media (max-width: 768px) {
            .products, .charolas, .extras {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .products, .charolas, .extras {
                grid-template-columns: 1fr;
            }
        }

        .product-item, .charola-item, .extra-item {
            background-color: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .product-item:hover, .charola-item:hover, .extra-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
        }

        .product-item button, .charola-item button, .extra-item button {
            background-color: #FF5733;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.3s ease, transform 0.3s ease;
        }

        .product-item button:hover, .charola-item button:hover, .extra-item button:hover {
            background-color: #FF4F41;
            transform: scale(1.05);
        }

        .product-item button:disabled, .charola-item button:disabled, .extra-item button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .proximamente {
            display: flex;
            justify-content: space-around;
            text-align: center;
            font-size: 1.3em;
            color: #FF5733;
        }

        .proximamente div {
            background-color: white;
            border-radius: 12px;
            padding: 25px;
            width: 45%;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .proximamente div:hover {
            transform: translateY(-5px);
        }

        @media (max-width: 768px) {
            .proximamente {
                flex-direction: column;
                align-items: center;
            }
            .proximamente div {
                width: 80%;
                margin-bottom: 20px;
            }
        }

        #cart {
            background-color: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        #cart input, #cart select {
            width: 100%;
            padding: 12px;
            margin: 12px 0;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 1em;
        }

        #cart button {
            background-color: #FF5733;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.3s ease, transform 0.3s ease;
        }

        #cart button:hover {
            background-color: #FF4F41;
            transform: scale(1.05);
        }

        #map {
            height: 300px;
            margin: 20px 0;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        footer {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #FFE4C4, #FFF8F0);
            box-shadow: 0 -2px 4px rgba(0,0,0,0.1);
        }

        footer a {
            margin: 0 15px;
            text-decoration: none;
            color: #FF5733;
            font-weight: 600;
            transition: color 0.3s ease;
        }

        footer a:hover {
            color: #FF4F41;
        }
    </style>
</head>
<body>
    <header>
        <img src="assets/Logo_Principal.png" alt="P&C Candys Logo">
    </header>
    <nav>
        <a href="#quienes-somos">Qui√©nes Somos</a>
        <a href="#galeria">Galer√≠a</a>
        <a href="#gomitas">Bolsa de Gomitas</a>
        <a href="#charolas">Charolas</a>
        <a href="#extras">Extras</a>
        <a href="#proximamente">Pr√≥ximamente</a>
        <a href="#cart">Pedidos</a>
    </nav>

    <section id="quienes-somos" class="quienes-somos">
        <h2>Qui√©nes Somos</h2>
        <p>P&C Candys es un emprendimiento hecho con amor por Paulo y Carol, donde combinamos sabor, creatividad y pasi√≥n. Empezamos con nuestras deliciosas gomitas enchiladas y vamos creciendo para ofrecerte productos √∫nicos y variados, siempre con ese toque casero y especial.</p>
        <p>Nos mueve la idea de crear algo diferente, divertido y lleno de cari√±o. ¬°Esto apenas comienza y t√∫ eres parte de esta historia! üíï</p>
    </section>

    <section id="galeria">
        <h2>Galer√≠a</h2>
        <div class="gallery">
            <div class="gallery-item">
                <img src="https://via.placeholder.com/300x180" alt="Aros de Durazno">
                <h3>Aros de Durazno</h3>
                <p>Deliciosos aros con sabor a durazno, disponibles naturales o enchilados.</p>
            </div>
            <div class="gallery-item">
                <img src="https://via.placeholder.com/300x180" alt="Aros de Manzana">
                <h3>Aros de Manzana</h3>
                <p>Frescos y dulces, con opci√≥n de chamoy o empanizado.</p>
            </div>
            <div class="gallery-item">
                <img src="https://via.placeholder.com/300x180" alt="Orugas y Panditas">
                <h3>Orugas y Panditas</h3>
                <p>Gomitas cl√°sicas con un toque picosito, ahogadas o empanizadas.</p>
            </div>
            <div class="gallery-item">
                <img src="https://via.placeholder.com/300x180" alt="Frutitas">
                <h3>Frutitas</h3>
                <p>Mezcla de sabores frutales con un toque picoso.</p>
            </div>
            <div class="gallery-item">
                <img src="https://via.placeholder.com/300x180" alt="Corazones">
                <h3>Corazones</h3>
                <p>Gomitas en forma de coraz√≥n, llenas de sabor y cari√±o.</p>
            </div>
            <div class="gallery-item">
                <img src="https://via.placeholder.com/300x180" alt="Xtreme">
                <h3>Xtreme</h3>
                <p>Gomitas intensas para los amantes del sabor picoso.</p>
            </div>
            <div class="gallery-item">
                <img src="https://via.placeholder.com/300x180" alt="Manguito">
                <h3>Manguito</h3>
                <p>Sabor tropical con un toque enchilado, perfecto para cualquier ocasi√≥n.</p>
            </div>
            <div class="gallery-item">
                <img src="https://via.placeholder.com/300x180" alt="Gajos de Naranja">
                <h3>Gajos de Naranja</h3>
                <p>Sabor c√≠trico con chamoy o empanizado, ¬°una explosi√≥n de sabor!</p>
            </div>
        </div>
    </section>

    <section id="gomitas">
        <img src="assets/Logo_gomitas.png" alt="Gomitas Logo" style="max-width: 100px; display: block; margin: 0 auto 20px;">
        <h2>Bolsa de Gomitas</h2>
        <p style="text-align: center; margin-bottom: 20px;">Pueden ser naturales, ahogadas ($10) o empanizadas ($15).</p>
        <div class="products">
            <div class="product-item">
                <h3>Aros de Durazno</h3>
                <p>4pz o 6pz</p>
                <select id="aros-durazno-type">
                    <option value="Naturales">Naturales - $10</option>
                    <option value="Ahogadas">Ahogadas - $10</option>
                    <option value="Empanizadas">Empanizadas - $15</option>
                </select>
                <select id="aros-durazno-size">
                    <option value="4pz">4pz</option>
                    <option value="6pz">6pz</option>
                </select>
                <button onclick="addToCart('Aros de Durazno', document.getElementById('aros-durazno-type').value, document.getElementById('aros-durazno-size').value)">Agregar al carrito</button>
            </div>
            <div class="product-item">
                <h3>Aros de Manzana</h3>
                <p>4pz o 6pz</p>
                <select id="aros-manzana-type">
                    <option value="Naturales">Naturales - $10</option>
                    <option value="Ahogadas">Ahogadas - $10</option>
                    <option value="Empanizadas">Empanizadas - $15</option>
                </select>
                <select id="aros-manzana-size">
                    <option value="4pz">4pz</option>
                    <option value="6pz">6pz</option>
                </select>
                <button onclick="addToCart('Aros de Manzana', document.getElementById('aros-manzana-type').value, document.getElementById('aros-manzana-size').value)">Agregar al carrito</button>
            </div>
            <div class="product-item">
                <h3>Orugas y Panditas</h3>
                <p>Ahogadas: $10 / Empanizadas: $15</p>
                <select id="orugas-type">
                    <option value="Ahogadas">Ahogadas - $10</option>
                    <option value="Empanizadas">Empanizadas - $15</option>
                </select>
                <button onclick="addToCart('Orugas y Panditas', document.getElementById('orugas-type').value, 'Standard')">Agregar al carrito</button>
            </div>
            <div class="product-item">
                <h3>Frutitas</h3>
                <p>Ahogadas: $10 / Empanizadas: $15</p>
                <select id="frutitas-type">
                    <option value="Ahogadas">Ahogadas - $10</option>
                    <option value="Empanizadas">Empanizadas - $15</option>
                </select>
                <button onclick="addToCart('Frutitas', document.getElementById('frutitas-type').value, 'Standard')">Agregar al carrito</button>
            </div>
            <div class="product-item">
                <h3>Corazones</h3>
                <p>Ahogadas: $10 / Empanizadas: $15</p>
                <select id="corazones-type">
                    <option value="Ahogadas">Ahogadas - $10</option>
                    <option value="Empanizadas">Empanizadas - $15</option>
                </select>
                <button onclick="addToCart('Corazones', document.getElementById('corazones-type').value, 'Standard')">Agregar al carrito</button>
            </div>
            <div class="product-item">
                <h3>Xtreme</h3>
                <p>Ahogadas: $10 / Empanizadas: $15</p>
                <select id="xtreme-type">
                    <option value="Ahogadas">Ahogadas - $10</option>
                    <option value="Empanizadas">Empanizadas - $15</option>
                </select>
                <button onclick="addToCart('Xtreme', document.getElementById('xtreme-type').value, 'Standard')">Agregar al carrito</button>
            </div>
            <div class="product-item">
                <h3>Manguito</h3>
                <p>Ahogadas: $10 / Empanizadas: $15</p>
                <select id="manguito-type">
                    <option value="Ahogadas">Ahogadas - $10</option>
                    <option value="Empanizadas">Empanizadas - $15</option>
                </select>
                <button onclick="addToCart('Manguito', document.getElementById('manguito-type').value, 'Standard')">Agregar al carrito</button>
            </div>
            <div class="product-item">
                <h3>Gajos de Naranja</h3>
                <p>Ahogadas: $10 / Empanizadas: $15</p>
                <select id="gajos-naranja-type">
                    <option value="Ahogadas">Ahogadas - $10</option>
                    <option value="Empanizadas">Empanizadas - $15</option>
                </select>
                <button onclick="addToCart('Gajos de Naranja', document.getElementById('gajos-naranja-type').value, 'Standard')">Agregar al carrito</button>
            </div>
            <div class="product-item">
                <h3>Delfines</h3>
                <p>Ahogadas: $10 / Empanizadas: $15</p>
                <select id="delfines-type">
                    <option value="Ahogadas">Ahogadas - $10</option>
                    <option value="Empanizadas">Empanizadas - $15</option>
                </select>
                <button onclick="addToCart('Delfines', document.getElementById('delfines-type').value, 'Standard')">Agregar al carrito</button>
            </div>
            <div class="product-item">
                <h3>Ping√ºinos</h3>
                <p>Ahogadas: Pr√≥ximamente / Empanizadas: Pr√≥ximamente</p>
                <button disabled>Pr√≥ximamente</button>
            </div>
        </div>
    </section>

    <section id="charolas">
        <img src="assets/Logo_HF.png" alt="Charolas Logo" style="max-width: 100px; display: block; margin: 0 auto 20px;">
        <h2>Charolas</h2>
        <p style="text-align: center; margin-bottom: 20px;">Pueden ser naturales, ahogadas o empanizadas.</p>
        <div class="charolas">
            <div class="charola-item">
                <h3>Mini Mix</h3>
                <p>1 a 4 tipos de gomitas</p>
                <p>Naturales: $40 / Ahogadas: $50 / Empanizadas: $60</p>
                <select id="mini-mix-type">
                    <option value="Naturales">Naturales - $40</option>
                    <option value="Ahogadas">Ahogadas - $50</option>
                    <option value="Empanizadas">Empanizadas - $60</option>
                </select>
                <select id="mini-mix-gomitas" multiple>
                    <option value="Corazones">Corazones</option>
                    <option value="Xtreme">Xtreme</option>
                    <option value="Aros de Durazno">Aros de Durazno</option>
                    <option value="Aros de Manzana">Aros de Manzana</option>
                    <option value="Frutas Enchiladas">Frutas Enchiladas</option>
                    <option value="Orugas y Panditas">Orugas y Panditas</option>
                    <option value="Manguitos">Manguitos</option>
                    <option value="Gajos de Naranja">Gajos de Naranja</option>
                    <option value="Delfines">Delfines</option>
                    <option value="Ping√ºinos">Ping√ºinos</option>
                </select>
                <button onclick="addCharolaToCart('Mini Mix', document.getElementById('mini-mix-type').value, document.getElementById('mini-mix-gomitas').selectedOptions, 4)">Agregar al carrito</button>
            </div>
            <div class="charola-item">
                <h3>Charola Deluxe</h3>
                <p>5 tipos + manzana con chamoy</p>
                <p>Naturales: $90 / Ahogadas: $100 / Empanizadas: $110</p>
                <select id="charola-deluxe-type">
                    <option value="Naturales">Naturales - $90</option>
                    <option value="Ahogadas">Ahogadas - $100</option>
                    <option value="Empanizadas">Empanizadas - $110</option>
                </select>
                <select id="charola-deluxe-gomitas" multiple>
                    <option value="Corazones">Corazones</option>
                    <option value="Xtreme">Xtreme</option>
                    <option value="Aros de Durazno">Aros de Durazno</option>
                    <option value="Aros de Manzana">Aros de Manzana</option>
                    <option value="Frutas Enchiladas">Frutas Enchiladas</option>
                    <option value="Orugas y Panditas">Orugas y Panditas</option>
                    <option value="Manguitos">Manguitos</option>
                    <option value="Gajos de Naranja">Gajos de Naranja</option>
                    <option value="Delfines">Delfines</option>
                    <option value="Ping√ºinos">Ping√ºinos</option>
                </select>
                <button onclick="addCharolaToCart('Charola Deluxe', document.getElementById('charola-deluxe-type').value, document.getElementById('charola-deluxe-gomitas').selectedOptions, 5)">Agregar al carrito</button>
            </div>
            <div class="charola-item">
                <h3>Maxi Mix</h3>
                <p>4 a 6 tipos de gomitas</p>
                <p>Naturales: $60 / Ahogadas: $70 / Empanizadas: $80</p>
                <select id="maxi-mix-type">
                    <option value="Naturales">Naturales - $60</option>
                    <option value="Ahogadas">Ahogadas - $70</option>
                    <option value="Empanizadas">Empanizadas - $80</option>
                </select>
                <select id="maxi-mix-gomitas" multiple>
                    <option value="Corazones">Corazones</option>
                    <option value="Xtreme">Xtreme</option>
                    <option value="Aros de Durazno">Aros de Durazno</option>
                    <option value="Aros de Manzana">Aros de Manzana</option>
                    <option value="Frutas Enchiladas">Frutas Enchiladas</option>
                    <option value="Orugas y Panditas">Orugas y Panditas</option>
                    <option value="Manguitos">Manguitos</option>
                    <option value="Gajos de Naranja">Gajos de Naranja</option>
                    <option value="Delfines">Delfines</option>
                    <option value="Ping√ºinos">Ping√ºinos</option>
                </select>
                <button onclick="addCharolaToCart('Maxi Mix', document.getElementById('maxi-mix-type').value, document.getElementById('maxi-mix-gomitas').selectedOptions, 6)">Agregar al carrito</button>
            </div>
            <div class="charola-item">
                <h3>Mega Deluxe</h3>
                <p>10 tipos + manzana con chamoy</p>
                <p>Naturales: $160 / Ahogadas: $170 / Empanizadas: $180</p>
                <select id="mega-deluxe-type">
                    <option value="Naturales">Naturales - $160</option>
                    <option value="Ahogadas">Ahogadas - $170</option>
                    <option value="Empanizadas">Empanizadas - $180</option>
                </select>
                <select id="mega-deluxe-gomitas" multiple>
                    <option value="Corazones">Corazones</option>
                    <option value="Xtreme">Xtreme</option>
                    <option value="Aros de Durazno">Aros de Durazno</option>
                    <option value="Aros de Manzana">Aros de Manzana</option>
                    <option value="Frutas Enchiladas">Frutas Enchiladas</option>
                    <option value="Orugas y Panditas">Orugas y Panditas</option>
                    <option value="Manguitos">Manguitos</option>
                    <option value="Gajos de Naranja">Gajos de Naranja</option>
                    <option value="Delfines">Delfines</option>
                    <option value="Ping√ºinos">Ping√ºinos</option>
                </select>
                <button onclick="addCharolaToCart('Mega Deluxe', document.getElementById('mega-deluxe-type').value, document.getElementById('mega-deluxe-gomitas').selectedOptions, 10)">Agregar al carrito</button>
            </div>
        </div>
    </section>

    <section id="extras">
        <img src="assets/Logo_HF.png" alt="Extras Logo" style="max-width: 100px; display: block; margin: 0 auto 20px;">
        <h2>Extras</h2>
        <div class="extras">
            <div class="extra-item">
                <h3>Manzanas con Chamoy</h3>
                <p>$15</p>
                <button onclick="addToCart('Manzanas con Chamoy', 'Standard', null, 15)">Agregar al carrito</button>
            </div>
            <div class="extra-item">
                <h3>Chamoy Extra</h3>
                <p>$7</p>
                <button onclick="addToCart('Chamoy Extra', 'Standard', null, 7)">Agregar al carrito</button>
            </div>
        </div>
    </section>

    <section id="proximamente">
        <h2>Pr√≥ximamente</h2>
        <div class="proximamente">
            <div>
                <h3>Mini Hotcakes</h3>
                <p>‚ú® Pr√≥ximamente ‚ú®</p>
            </div>
            <div>
                <h3>Fresas con Crema</h3>
                <p>üçì Pr√≥ximamente üçì</p>
            </div>
        </div>
    </section>

    <section id="cart">
        <h2>Zona de Pedidos</h2>
        <div id="cart-items"></div>
        <form id="order-form">
            <label>Pedido programado para:</label>
            <input type="date" id="delivery-date" required>
            <label>Entrega en:</label>
            <input type="text" id="address" placeholder="Direcci√≥n (ej. Av. Principal 123, Quer√©taro)" required>
            <p>Haz clic en el mapa para seleccionar el punto de entrega:</p>
            <div id="map"></div>
            <input type="hidden" id="map-link" value="https://maps.google.com/?q=20.5937,-100.3996">
            <label>Nombre:</label>
            <input type="text" id="name" required>
            <label>Contacto:</label>
            <input type="text" id="contact" required>
            <label>M√©todo de pago:</label>
            <select id="payment-method">
                <option value="Efectivo">Efectivo</option>
                <option value="Transferencia">Transferencia</option>
            </select>
            <p>Total: $<span id="total">0</span></p>
            <button type="submit">Confirmar Pedido</button>
        </form>
    </section>

    <footer>
        <h3>S√≠guenos en redes sociales</h3>
        <a href="https://www.facebook.com/profile.php?id=61577579375119">Facebook</a>
        <a href="https://www.instagram.com/pc.candys">Instagram</a>
        <a href="https://wa.me/524481012425">WhatsApp</a>
    </footer>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        let cart = [];
        let map, marker;

        // Initialize map and geolocation
        window.onload = function() {
            console.log('Page loaded, initializing map and delivery date');
            const defaultPos = { lat: 20.5937, lng: -100.3996 }; // Quer√©taro, M√©xico
            map = L.map('map').setView([defaultPos.lat, defaultPos.lng], 12);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
            }).addTo(map);
            marker = L.marker([defaultPos.lat, defaultPos.lng], { draggable: true }).addTo(map);
            document.getElementById('map-link').value = `https://maps.google.com/?q=${defaultPos.lat},${defaultPos.lng}`;

            // Allow user to click on map to set marker
            map.on('click', function(e) {
                marker.setLatLng(e.latlng);
                document.getElementById('map-link').value = `https://maps.google.com/?q=${e.latlng.lat},${e.latlng.lng}`;
                console.log('Map clicked, updated marker to:', e.latlng);
            });

            // Update map-link on marker drag
            marker.on('dragend', function(e) {
                const pos = marker.getLatLng();
                document.getElementById('map-link').value = `https://maps.google.com/?q=${pos.lat},${pos.lng}`;
                console.log('Marker dragged to:', pos);
            });

            // Try geolocation
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const userPos = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        console.log('Geolocation success:', userPos);
                        map.setView([userPos.lat, userPos.lng], 12);
                        marker.setLatLng([userPos.lat, userPos.lng]);
                        document.getElementById('map-link').value = `https://maps.google.com/?q=${userPos.lat},${userPos.lng}`;
                    },
                    (error) => {
                        console.warn('Geolocation failed:', error.message);
                        // Fallback to default position
                        document.getElementById('map-link').value = `https://maps.google.com/?q=${defaultPos.lat},${defaultPos.lng}`;
                    }
                );
            } else {
                console.warn('Geolocation not supported');
            }

            // Set minimum delivery date
            updateDeliveryDate();
        };

        function updateDeliveryDate() {
            const today = new Date();
            const hours = today.getHours();
            const minDate = new Date();
            if (hours >= 12) {
                minDate.setDate(today.getDate() + 1); // Tomorrow
            } else {
                minDate.setDate(today.getDate()); // Today
            }
            const minDateStr = minDate.toISOString().split('T')[0];
            console.log('Setting min delivery date to:', minDateStr);
            document.getElementById('delivery-date').setAttribute('min', minDateStr);
            // Ensure the input is cleared to avoid stale values
            document.getElementById('delivery-date').value = '';
        }

        function addToCart(product, type, size, fixedPrice) {
            const price = fixedPrice || (type === 'Empanizadas' ? 15 : 10);
            cart.push({ product, type, size, price });
            console.log('Added to cart:', { product, type, size, price });
            updateCart();
        }

        function addCharolaToCart(charola, type, gomitas, maxGomitas) {
            const prices = {
                'Mini Mix': { Naturales: 40, Ahogadas: 50, Empanizadas: 60 },
                'Charola Deluxe': { Naturales: 90, Ahogadas: 100, Empanizadas: 110 },
                'Maxi Mix': { Naturales: 60, Ahogadas: 70, Empanizadas: 80 },
                'Mega Deluxe': { Naturales: 160, Ahogadas: 170, Empanizadas: 180 }
            };
            const selectedGomitas = Array.from(gomitas).map(opt => opt.value);
            if (selectedGomitas.length > maxGomitas) {
                alert(`Selecciona un m√°ximo de ${maxGomitas} tipos de gomitas para ${charola}.`);
                return;
            }
            if (selectedGomitas.length < (charola === 'Charola Deluxe' || charola === 'Mega Deluxe' ? maxGomitas : 1)) {
                alert(`Selecciona al menos ${charola === 'Charola Deluxe' || charola === 'Mega Deluxe' ? maxGomitas : 1} tipo(s) de gomitas para ${charola}.`);
                return;
            }
            cart.push({ product: charola, type, gomitas: selectedGomitas, price: prices[charola][type] });
            console.log('Added charola to cart:', { charola, type, gomitas: selectedGomitas, price: prices[charola][type] });
            updateCart();
        }

        function updateCart() {
            const cartItems = document.getElementById('cart-items');
            cartItems.innerHTML = '<h3>Productos</h3>';
            let total = 0;
            cart.forEach(item => {
                cartItems.innerHTML += `<p>${item.product} (${item.type}${item.size ? ' - ' + item.size : ''}${item.gomitas ? ' - ' + item.gomitas.join(', ') : ''}) - $${item.price}</p>`;
                total += item.price;
            });
            document.getElementById('total').textContent = total;
            console.log('Cart updated, total:', total);
        }

        document.getElementById('order-form').addEventListener('submit', function(e) {
            e.preventDefault();
            console.log('Form submitted, processing order');

            // Check if cart is empty
            if (cart.length === 0) {
                alert('Por favor, agrega al menos un producto al carrito antes de confirmar el pedido.');
                return;
            }

            // Validate delivery date
            const dateInput = document.getElementById('delivery-date').value;
            if (!dateInput) {
                alert('Por favor, selecciona una fecha de entrega.');
                return;
            }
            const date = new Date(dateInput);
            const today = new Date();
            const hours = today.getHours();
            const minDate = new Date();
            if (hours >= 12) {
                minDate.setDate(today.getDate() + 1); // Tomorrow
            } else {
                minDate.setDate(today.getDate()); // Today
            }
            minDate.setHours(0, 0, 0, 0);
            date.setHours(0, 0, 0, 0);
            if (date < minDate) {
                const minDateStr = minDate.toISOString().split('T')[0];
                alert(`Los pedidos para el mismo d√≠a deben realizarse antes de las 12:00 p.m. CST. Selecciona una fecha a partir del ${minDateStr}.`);
                return;
            }

            // Gather form data
            const address = document.getElementById('address').value;
            const mapLink = document.getElementById('map-link').value;
            const name = document.getElementById('name').value;
            const contact = document.getElementById('contact').value;
            const payment = document.getElementById('payment-method').value;
            const total = document.getElementById('total').textContent;

            if (!address || !name || !contact) {
                alert('Por favor, completa todos los campos obligatorios.');
                return;
            }

            // Build products list
            let products = cart.map(item => `${item.product} (${item.type}${item.size ? ' - ' + item.size : ''}${item.gomitas ? ' - ' + item.gomitas.join(', ') : ''}) - $${item.price}`).join('\n');

            // Construct WhatsApp message with exact format
            const message = `üç≠ P&C Candys te consiente üç≠
üìÖ Pedido programado para: ${date.toISOString().split('T')[0]}
üìç Entrega en: ${address}
üó∫Ô∏è Ubicaci√≥n: ${mapLink}
üí∞ Total: $${total}
üë§ Nombre: ${name}
üìû Contacto: ${contact}
üí≥ M√©todo de pago: ${payment}
üõçÔ∏è Productos: ${products}
‚ú® ¬°Gracias por elegirnos! Nos encargaremos de que tu d√≠a est√© lleno de dulzura y ese toquecito picosito que tanto te gusta.
üì¶ Te confirmamos cuando vayamos en camino.`;

            try {
                const encodedMessage = encodeURIComponent(message);
                console.log('Opening WhatsApp with message to +524481012425');
                window.open(`https://wa.me/524481012425?text=${encodedMessage}`, '_blank');

                // Reset form and cart
                console.log('Resetting form and cart');
                cart = [];
                updateCart();
                document.getElementById('order-form').reset();
                document.getElementById('total').textContent = '0';
                const defaultPos = { lat: 20.5937, lng: -100.3996 };
                document.getElementById('map-link').value = `https://maps.google.com/?q=${defaultPos.lat},${defaultPos.lng}`;
                map.setView([defaultPos.lat, defaultPos.lng], 12);
                marker.setLatLng([defaultPos.lat, defaultPos.lng]);
                updateDeliveryDate();
            } catch (error) {
                console.error('Error during form submission:', error);
                alert('Ocurri√≥ un error al enviar el pedido. Por favor, intenta de nuevo.');
            }
        });
    </script>
</body>
</html>