<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Pedidos - P&C Candys</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0; padding: 0;
            background-color: #f5f5f5;
            color: #333;
        }
        header {
            background-color: #f44336;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #d32f2f;
            position: relative;
            z-index: 1000;
        }
        .logo {
            font-size: 4vw;
            font-weight: bold;
            color: white;
            margin-left: 10px;
        }
        .menu-toggle {
            font-size: 4vw;
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            display: none;
            margin-right: 10px;
            z-index: 1001;
        }
        .nav-menu {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            align-items: center;
            z-index: 1000;
        }
        .nav-menu li {
            margin-left: 2vw;
        }
        .nav-menu a {
            color: white;
            text-decoration: none;
            font-size: 3vw;
        }
        .nav-menu.active {
            display: flex;
            flex-direction: column;
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            background-color: #f44336;
            padding: 10px 0;
            z-index: 1000;
        }
        .order-section {
            padding: 5vw;
            text-align: center;
        }
        .order-section h1 {
            color: #1e88e5;
            font-size: 5vw;
            margin-bottom: 2vw;
        }
        .order-form {
            max-width: 90vw;
            margin: 0 auto;
            background-color: white;
            padding: 3vw;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        .order-form label {
            display: block;
            font-size: 2.5vw;
            margin-bottom: 1vw;
            color: #1e88e5;
            text-align: left;
        }
        .order-form input,
        .order-form select {
            width: 90%;
            padding: 1.5vw;
            margin-bottom: 2vw;
            font-size: 2.5vw;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        #map {
            width: 90%;
            height: 400px;
            margin: 2vw auto;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .order-form button {
            background-color: #4caf50;
            color: white;
            border: none;
            padding: 2vw 4vw;
            border-radius: 5px;
            font-size: 2.5vw;
            cursor: pointer;
        }
        .order-form button:hover {
            background-color: #45a049;
        }
        #orderItems {
            margin: 2vw 0;
            text-align: left;
            max-width: 90vw;
            margin-left: auto;
            margin-right: auto;
        }
        #orderItems h3 {
            font-size: 3vw;
            margin-bottom: 1vw;
            color: #1976d2;
        }
        #orderItems p {
            font-size: 2.5vw;
            margin: 1vw 0;
        }
        #orderItems ul {
            padding-left: 1.5em;
        }
        #orderItems li {
            margin-bottom: 1vw;
            font-size: 2.5vw;
            display: flex;
            justify-content: space-between;
            align-items: center;
            list-style: disc inside;
        }
        #orderItems li button {
            background: #f44336;
            border: none;
            color: white;
            border-radius: 50%;
            width: 2.5em;
            height: 2.5em;
            font-size: 2vw;
            cursor: pointer;
            line-height: 1;
            margin-left: 1em;
        }
        footer {
            background-color: #1976d2;
            color: white;
            padding: 3vw;
            text-align: center;
            margin-top: 5vw;
        }
        .social-icons a {
            color: white;
            margin: 0 2vw;
            text-decoration: none;
            font-size: 4vw;
        }
    </style>
</head>
<body>
<header>
    <div class="logo">P&C Candys</div>
    <button class="menu-toggle" aria-label="Toggle menu">☰</button>
    <ul class="nav-menu">
        <li><a href="index.html">Inicio</a></li>
        <li><a href="bolsa_de_gomitas.html">Bolsa de Gomitas</a></li>
        <li><a href="charolas.html">Charolas</a></li>
        <li><a href="mini_hot_cakes.html">Mini Hot Cakes</a></li>
        <li><a href="fresas_con_crema.html">Fresas con Crema</a></li>
        <li><a href="extras.html">Extras</a></li>
        <li><a href="pedidos.html">Pedidos</a></li>
    </ul>
</header>

<section class="order-section">
    <h1>Realiza tu Pedido</h1>
    <div class="order-form">
        <div id="orderItems">
            <h3>Productos Seleccionados:</h3>
            <p id="orderList">No has seleccionado productos aún.</p>
        </div>
        <label for="orderDate">Pedido programado para:</label>
        <input type="date" id="orderDate" required />
        <label for="address">Entrega en:</label>
        <input type="text" id="address" placeholder="Dirección" required />
        <label>Selecciona tu ubicación:</label>
        <button type="button" onclick="getLocation()">Usar mi ubicación actual</button>
        <div id="map"></div>
        <input type="hidden" id="latitud" />
        <input type="hidden" id="longitud" />
        <label for="clientName">Nombre:</label>
        <input type="text" id="clientName" placeholder="Tu nombre" required />
        <label for="phone">Número de teléfono:</label>
        <input type="tel" id="phone" placeholder="Ej. 555-123-4567" required />
        <label for="paymentMethod">Método de pago:</label>
        <select id="paymentMethod" required>
            <option value="">Selecciona</option>
            <option value="efectivo">Efectivo</option>
            <option value="tarjeta">Tarjeta</option>
            <option value="transferencia">Transferencia</option>
        </select>
        <button type="button" onclick="submitOrder()">Enviar Pedido</button>
    </div>
</section>

<footer>
    <h3>Redes Sociales</h3>
    <div class="social-icons">
        <a href="https://facebook.com/PyCCandys" target="_blank">Facebook</a>
        <a href="https://instagram.com/PyCCandys" target="_blank">Instagram</a>
        <a href="https://wa.me/524481012425" target="_blank">WhatsApp</a>
        <a href="https://tiktok.com/@PyCCandys" target="_blank">TikTok</a>
    </div>
</footer>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
let orders = JSON.parse(localStorage.getItem('orders')) || [];
let map, marker;

window.onload = function () {
    updateOrderList();
    initMap();
};

function updateOrderList() {
    const orderList = document.getElementById('orderList');
    if (orders.length > 0) {
        let ul = document.createElement('ul');
        orders.forEach((item, index) => {
            let li = document.createElement('li');
            let text = `${item.name}`;
            if (item.variety) text += ` (${item.variety})`;
            text += ` - $${item.price}`;
            li.textContent = text;
            let btnDelete = document.createElement('button');
            btnDelete.textContent = '×';
            btnDelete.onclick = () => removeOrderItem(index);
            li.appendChild(btnDelete);
            ul.appendChild(li);
        });
        orderList.innerHTML = '';
        orderList.appendChild(ul);
    } else {
        orderList.textContent = 'No has seleccionado productos aún.';
    }
}

function removeOrderItem(index) {
    orders.splice(index, 1);
    localStorage.setItem('orders', JSON.stringify(orders));
    updateOrderList();
}

function initMap() {
    const latInput = document.getElementById('latitud');
    const lngInput = document.getElementById('longitud');
    let lat = 20.5021080, lng = -100.1445436;
    map = L.map('map').setView([lat, lng], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '© OpenStreetMap contributors',
    }).addTo(map);
    marker = L.marker([lat, lng], { draggable: true }).addTo(map);
    marker.on('dragend', function () {
        const latlng = marker.getLatLng();
        latInput.value = latlng.lat.toFixed(6);
        lngInput.value = latlng.lng.toFixed(6);
    });
    map.on('click', function (e) {
        marker.setLatLng(e.latlng);
        latInput.value = e.latlng.lat.toFixed(6);
        lngInput.value = e.latlng.lng.toFixed(6);
    });
}

function getLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function (position) {
            const lat = position.coords.latitude, lng = position.coords.longitude;
            document.getElementById('latitud').value = lat.toFixed(6);
            document.getElementById('longitud').value = lng.toFixed(6);
            map.setView([lat, lng], 13);
            marker.setLatLng([lat, lng]);
        });
    } else {
        alert('Geolocalización no soportada por este navegador.');
    }
}

function submitOrder() {
    const orderDate = document.getElementById('orderDate').value;
    const address = document.getElementById('address').value.trim();
    const latitude = document.getElementById('latitud').value;
    const longitude = document.getElementById('longitud').value;
    const clientName = document.getElementById('clientName').value.trim();
    const phone = document.getElementById('phone').value.trim();
    const paymentMethod = document.getElementById('paymentMethod').value;

    if (!orderDate || !address || !latitude || !longitude || !clientName || !phone || !paymentMethod) {
        alert('Por favor, completa todos los campos y selecciona ubicación.');
        return;
    }
    if (orders.length === 0) {
        alert('No has seleccionado productos para tu pedido.');
        return;
    }

    const total = orders.reduce((sum, item) => sum + (parseFloat(item.price) || 0), 0).toFixed(2);
    let productDetails = '';
    orders.forEach(item => {
        productDetails += `${item.name} (${item.variety || 'No especificado'}) - $${item.price}\n`;
    });

    const confirmMsg = `¿Tu pedido está correcto?\n\n📅 Fecha: ${orderDate}\n📍 Dirección: ${address}\n👤 ${clientName}\n☎ ${phone}\n💳 Pago: ${paymentMethod}\n\nProductos:\n${productDetails}\nTOTAL: $${total}\n\n¿Deseas enviarlo?`;

    if (confirm(confirmMsg)) {
        const message = `Hola, me gustaría hacer un pedido:\n\nFecha: ${orderDate}\nDirección: ${address}\nUbicación: https://www.google.com/maps?q=${latitude},${longitude}\nNombre: ${clientName}\nTel: ${phone}\nPago: ${paymentMethod}\n\nProductos:\n${productDetails}\nTOTAL: $${total}`;
        const whatsappNumber = "524481012425";
        const url = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(message)}`;
        window.open(url, '_blank');
    } else {
        alert("Puedes modificar tu pedido antes de enviarlo.");
    }
}

document.querySelector('.menu-toggle').addEventListener('click', () => {
    document.querySelector('.nav-menu').classList.toggle('active');
});
</script>
</body>
</html>