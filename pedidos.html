<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pedidos - P&C Candys</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: #333;
        }
        header {
            background-color: #f44336;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #d32f2f;
        }
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: white;
            margin-left: 10px;
        }
        .nav-menu {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            align-items: center;
        }
        .nav-menu li {
            margin-left: 20px;
        }
        .nav-menu a {
            color: white;
            text-decoration: none;
            font-size: 16px;
        }
        .order-section {
            padding: 20px;
            text-align: center;
        }
        .order-section h1 {
            color: #1e88e5;
            font-size: 32px;
            margin-bottom: 20px;
        }
        .order-form {
            max-width: 600px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        .order-form label {
            display: block;
            font-size: 16px;
            margin-bottom: 10px;
            color: #1e88e5;
        }
        .order-form input, .order-form select {
            width: 90%;
            padding: 8px;
            margin-bottom: 15px;
            font-size: 14px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        #map {
            width: 90%;
            height: 400px;
            margin: 15px auto;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .order-form button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 14px;
            cursor: pointer;
        }
        .order-form button:hover {
            background-color: #45a049;
        }
        #orderItems {
            margin: 15px 0;
            text-align: left;
        }
        #orderItems .order-item {
            background-color: #f9f9f9;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        #orderItems .order-item p {
            font-size: 14px;
            margin: 0;
        }
        #orderItems .order-item button {
            background-color: #f44336;
            padding: 6px 12px;
            font-size: 12px;
            margin-left: 10px;
        }
        #orderItems .order-item button:hover {
            background-color: #d32f2f;
        }
        #orderSummary {
            margin-top: 20px;
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            display: none;
        }
        #orderSummary p {
            font-size: 14px;
            margin: 10px 0;
        }
        footer {
            background-color: #1976d2;
            color: white;
            padding: 20px;
            text-align: center;
            margin-top: 50px;
        }
        .social-icons a {
            color: white;
            margin: 0 20px;
            text-decoration: none;
            font-size: 24px;
        }
        @media (max-width: 767px) {
            .logo { font-size: 4vw; }
            .nav-menu { display: none; }
            .order-section h1 { font-size: 5vw; }
            .order-form label { font-size: 2.5vw; }
            .order-form input, .order-form select { font-size: 2.5vw; padding: 1.5vw; }
            .order-form button { font-size: 2.5vw; padding: 1.5vw 3vw; }
            #orderItems .order-item p { font-size: 2vw; }
            #orderItems .order-item button { font-size: 1.5vw; padding: 1vw 2vw; }
            #orderSummary p { font-size: 2.5vw; }
            #map { height: 200px; }
            .social-icons a { font-size: 4vw; }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">üç≠ P&C Candys</div>
        <ul class="nav-menu">
            <li><a href="index.html">Inicio</a></li>
            <li><a href="bolsa_de_gomitas.html">Bolsa de Gomitas</a></li>
            <li><a href="charolas.html">Charolas</a></li>
            <li><a href="mini_hot_cakes.html">Mini Hot Cakes</a></li>
            <li><a href="fresas_con_crema.html">Fresas con Crema</a></li>
            <li><a href="extras.html">Extras</a></li>
            <li><a href="pedidos.html">Pedidos</a></li>
        </ul>
    </header>

    <section class="order-section">
        <h1>Realiza tu Pedido</h1>
        <div class="order-form">
            <div id="orderItems">
                <h3>Productos Seleccionados:</h3>
                <div id="orderList"></div>
            </div>
            <label for="orderDate">Pedido programado para:</label>
            <input type="date" id="orderDate" required>
            <label for="address">Entrega en:</label>
            <input type="text" id="address" placeholder="Direcci√≥n" required>
            <label>Selecciona tu ubicaci√≥n:</label>
            <button onclick="getLocation()">Usar mi ubicaci√≥n actual</button>
            <div id="map"></div>
            <input type="hidden" id="latitud">
            <input type="hidden" id="longitud">
            <label for="clientName">Nombre:</label>
            <input type="text" id="clientName" placeholder="Tu nombre" required>
            <label for="phone">N√∫mero de tel√©fono:</label>
            <input type="tel" id="phone" placeholder="Ej. 555-123-4567" required>
            <label for="paymentMethod">M√©todo de pago:</label>
            <select id="paymentMethod" required>
                <option value="">Selecciona</option>
                <option value="efectivo">Efectivo</option>
                <option value="tarjeta">Tarjeta</option>
                <option value="transferencia">Transferencia</option>
            </select>
            <button onclick="submitOrder()">Enviar Pedido</button>
        </div>
        <div id="orderSummary"></div>
    </section>

    <footer>
        <h3>Redes Sociales</h3>
        <div class="social-icons">
            <a href="https://facebook.com/PyCCandys">Facebook</a>
            <a href="https://instagram.com/PyCCandys">Instagram</a>
            <a href="https://wa.me/524481012425">WhatsApp</a>
            <a href="https://tiktok.com/@PyCCandys">TikTok</a>
        </div>
    </footer>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        let orders = JSON.parse(localStorage.getItem('orders')) || [];
        let map;

        window.onload = function() {
            updateOrderList();
            initMap();
        };

        function updateOrderList() {
            const orderList = document.getElementById('orderList');
            orderList.innerHTML = '';
            if (orders.length > 0) {
                orders.forEach((order, index) => {
                    const item = document.createElement('div');
                    item.className = 'order-item';
                    let gomitasText = order.quantities.length > 0 ? `Gomitas: ${order.quantities.join(', ')}` : 'Sin gomitas';
                    let appleText = order.hasApple ? ' + Manzana (+$15)' : '';
                    item.innerHTML = `
                        <p>${order.name} (${order.variety}) - $${order.price} - ${gomitasText}${appleText}</p>
                        <button onclick="removeOrder(${index})">Eliminar</button>
                    `;
                    orderList.appendChild(item);
                });
            } else {
                orderList.innerHTML = '<p>No has seleccionado productos a√∫n.</p>';
            }
        }

        function removeOrder(index) {
            orders.splice(index, 1);
            localStorage.setItem('orders', JSON.stringify(orders));
            updateOrderList();
        }

        function initMap() {
            map = L.map('map').setView([20.5888, -100.3899], 13); // Quer√©taro como ejemplo
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '¬© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);

            var marker = L.marker([20.5888, -100.3899], { draggable: true }).addTo(map);
            var latInput = document.getElementById('latitud');
            var lngInput = document.getElementById('longitud');

            marker.on('dragend', function(e) {
                var latlng = marker.getLatLng();
                latInput.value = latlng.lat.toFixed(6);
                lngInput.value = latlng.lng.toFixed(6);
            });

            map.on('click', function(e) {
                marker.setLatLng(e.latlng);
                latInput.value = e.latlng.lat.toFixed(6);
                lngInput.value = e.latlng.lng.toFixed(6);
            });
        }

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        var lat = position.coords.latitude;
                        var lng = position.coords.longitude;
                        document.getElementById('latitud').value = lat.toFixed(6);
                        document.getElementById('longitud').value = lng.toFixed(6);
                        if (map) map.remove();
                        map = L.map('map').setView([lat, lng], 13);
                        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                            maxZoom: 19,
                            attribution: '¬© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                        }).addTo(map);
                        var marker = L.marker([lat, lng], { draggable: true }).addTo(map);
                        marker.on('dragend', function(e) {
                            var latlng = marker.getLatLng();
                            document.getElementById('latitud').value = latlng.lat.toFixed(6);
                            document.getElementById('longitud').value = lng.toFixed(6);
                        });
                        map.on('click', function(e) {
                            marker.setLatLng(e.latlng);
                            document.getElementById('latitud').value = e.latlng.lat.toFixed(6);
                            document.getElementById('longitud').value = e.latlng.lng.toFixed(6);
                        });
                    },
                    function(error) {
                        alert("No se pudo obtener tu ubicaci√≥n. Por favor, selecciona manualmente en el mapa. Error: " + error.message);
                    }
                );
            } else {
                alert("Geolocalizaci√≥n no soportada por este navegador. Selecciona manualmente en el mapa.");
            }
        }

        function submitOrder() {
            const orderDate = document.getElementById('orderDate').value || 'No especificado';
            const address = document.getElementById('address').value || 'No especificado';
            const latitude = document.getElementById('latitud').value || '20.5888';
            const longitude = document.getElementById('longitud').value || '-100.3899';
            const clientName = document.getElementById('clientName').value || 'No especificado';
            const phone = document.getElementById('phone').value || 'No especificado';
            const paymentMethod = document.getElementById('paymentMethod').value || 'No especificado';

            if (!orderDate || !address || !latitude || !longitude || !clientName || !phone || !paymentMethod) {
                alert("Por favor, completa todos los campos obligatorios o selecciona una ubicaci√≥n.");
                return;
            }

            const total = orders.reduce((sum, item) => sum + (parseFloat(item.price) || 0), 0).toFixed(2);
            let productDetails = orders.map(order => `${order.name} (${order.variety}) - $${order.price} - Gomitas: ${order.quantities.join(', ')}${order.hasApple ? ' + Manzana (+$15)' : ''}`).join('\n');
            const mapLink = `https://maps.google.com/?q=${latitude},${longitude}`;

            const message = `
üëâ *Pedido seleccionado ‚Äì P&C Candys* üëà

¬°Gracias por tu pedido con P&C Candys! üç¨
Aqu√≠ est√°n los detalles:

üìÖ Fecha: ${orderDate}
üìç Entrega: ${address}
üó∫Ô∏è Mapa: ${mapLink}
üë§ Nombre: ${clientName}
üõí Pedido: ${productDetails || 'No especificado'}
üìû Tel√©fono: ${phone}
üí≥ M√©todo de pago: ${paymentMethod}
üí∞ Total: $${total}

Nos aseguraremos de preparar tu pedido con amor y cuidado. ¬°Gracias por endulzar tu d√≠a con nosotros! üòä
            `.trim();

            console.log("Mensaje:", message);
            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/524481012425?text=${encodedMessage}`;
            window.open(whatsappUrl, '_blank');

            orders = [];
            localStorage.setItem('orders', JSON.stringify(orders));
            updateOrderList();
            document.querySelector('.order-form').reset();
        }
    </script>
</body>
</html>